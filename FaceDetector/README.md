## OpenCVäººè„¸æ£€æµ‹-Haarçº§è”å’ŒLBP

**äººè„¸æ£€æµ‹-Haarçº§è”**

**æ¦‚è¿°**

âœ”ï¸ Haar çº§è”æ£€æµ‹å™¨ï¼ŒOpenCV ä¸­çš„ Haar çº§è”æ£€æµ‹å™¨æ”¯æŒäººè„¸æ£€æµ‹ã€å¾®ç¬‘ã€çœ¼ç›ä¸å˜´å·´æ£€æµ‹ç­‰ï¼Œé€šè¿‡åŠ è½½è¿™äº›é¢„å…ˆè®­ç»ƒçš„ Haar æ¨¡å‹æ•°æ®å¯ä»¥å®ç°ç›¸å…³çš„å¯¹è±¡æ£€æµ‹ã€‚

**Haarç‰¹å¾**

âœ”ï¸ Haar å°æ³¢åŸºå‡½æ•°ï¼Œå› ä¸ºå…¶æ»¡è¶³å¯¹ç§°æ€§ï¼Œå› æ­¤å¯¹äººè„¸è¿™ç§ç”Ÿç‰©å¯¹ç§°æ€§è‰¯å¥½çš„å¯¹è±¡ç‰¹åˆ«é€‚åˆç”¨æ¥åšæ£€æµ‹ã€‚

![image_1dgu20f2oj22jkm8ut1r4krv3p.png-109.6kB][1]
å°æ³¢å‡½æ•°

å¸¸è§çš„Haarç‰¹å¾åˆ†ä¸ºä¸‰ç±»ï¼š

- è¾¹ç¼˜ç‰¹å¾ï¼›
- çº¿æ€§ç‰¹å¾ï¼›
- ä¸­å¿ƒç‰¹å¾å’Œå¯¹è§’çº¿ç‰¹å¾ã€‚

**Haarç‰¹å¾**

âœ”ï¸ ä¸åŒç‰¹å¾å¯ä»¥è¿›è¡Œå¤šç§ç»„åˆï¼Œç”Ÿæˆæ›´åŠ å¤æ‚çš„çº§è”ç‰¹å¾ï¼Œç‰¹å¾æ¨¡æ¿å†…æœ‰ç™½è‰²å’Œé»‘è‰²ä¸¤ç§çŸ©å½¢ï¼Œå¹¶å®šä¹‰è¯¥æ¨¡æ¿çš„ç‰¹å¾å€¼ä¸ºç™½è‰²çŸ©å½¢åƒç´ å’Œå‡å»é»‘è‰²çŸ©å½¢åƒç´ å’Œï¼ŒHaarç‰¹å¾å€¼åæ˜ äº†å›¾åƒçš„å¯¹æ¯”åº¦ä¸æ¢¯åº¦å˜åŒ–ã€‚

**çº§è”**

âœ”ï¸ çº§è”åˆ†ç±»å™¨ç›¸å½“äºä¸€ä¸ªå†³ç­–æ ‘ï¼Œå±‚çº§åˆ¤æ–­ï¼Œæ›´åŠ å‡†ç¡®ã€‚

âœ”ï¸ è®­ç»ƒçš„æ—¶å€™ç”¨çš„ç…§ç‰‡ä¸€èˆ¬éƒ½æ˜¯25*25å·¦å³çš„å°å›¾ç‰‡ï¼Œæ‰€ä»¥å¯¹äºå¤§çš„äººè„¸ï¼Œè¿˜éœ€è¦è¿›è¡Œå¤šå°ºåº¦çš„æ£€æµ‹ï¼Œå¤šå°ºåº¦æ£€æµ‹æœºåˆ¶ä¸€èˆ¬æœ‰ä¸¤ç§ç­–ç•¥ï¼š - ä¸æ”¹å˜æœç´¢çª—å£çš„å¤§å°ï¼Œè€Œä¸æ–­ç¼©æ”¾å›¾ç‰‡ï¼Œè¿™ç§æ–¹æ³•æ˜¾ç„¶éœ€è¦å¯¹æ¯ä¸ªç¼©æ”¾åçš„å›¾ç‰‡è¿›è¡ŒåŒºåŸŸç‰¹å¾å€¼çš„è¿ç®—ï¼Œç±»ä¼¼äºåˆ¶ä½œå›¾åƒé‡‘å­—å¡”çš„æµç¨‹ï¼Œæ•ˆç‡ä¸é«˜ï¼› - ä¸æ–­åˆå§‹åŒ–æœç´¢çª—å£sizeä¸ºè®­ç»ƒæ—¶çš„å›¾ç‰‡å¤§å°ï¼Œä¸æ–­æ‰©å¤§æœç´¢çª—å£ï¼Œè¿›è¡Œæœç´¢ï¼Œè§£å†³äº†ç¬¬ä¸€ç§æ–¹æ³•çš„å¼±åŠ¿ã€‚

âœ”ï¸ OpenCVä¸­HAARç‰¹å¾è®¡ç®—æ˜¯ç§¯åˆ†å›¾æŠ€æœ¯ï¼Œå¯ä»¥éå¸¸å¿«é€Ÿé«˜æ•ˆçš„å¼€çª—æ£€æµ‹ï¼Œ HAARçº§è”æ£€æµ‹å™¨å…·å¤‡æœ‰å¦‚ä¸‹ç‰¹æ€§ï¼š - é«˜ç±»é—´å˜å¼‚æ€§ - ä½ç±»å†…å˜å¼‚æ€§ - å±€éƒ¨å¼ºåº¦å·® - ä¸åŒå°ºåº¦ - è®¡ç®—æ•ˆç‡é«˜

![image_1dgu24onh1ftab741llifq31euq16.png-208kB][2]
çº§è”åˆ¤æ–­

**å‡½æ•°**

é¢„å…ˆå®šä¹‰åŠ è½½face(eye,smile,etc)åˆ†ç±»å™¨ã€‚
```python
face = face_detector.detectMultiScale(image, scaleFactor, minNeighbors, minSize, maxSize)
```

**è¾“å…¥**

- Image --> è¾“å…¥å›¾åƒ
- ScaleFactor --> æ”¾ç¼©æ¯”ç‡, defaultä¸º1.1
- minNeighbors --> è¡¨ç¤ºæœ€ä½ç›¸é‚»çŸ©å½¢æ¡†, - - defaultä¸º3
- minSize --> å¯ä»¥æ£€æµ‹çš„æœ€å°äººè„¸
- maxSize --> å¯ä»¥æ£€æµ‹çš„æœ€å¤§äººè„¸

**è¾“å‡º**

- face --> äººè„¸çš„ä½ç½® (x, y, w, h)

**ä»£ç ç¤ºä¾‹**

### 1.äººè„¸æ£€æµ‹
```python
import cv2 as cv

face_detector = cv.CascadeClassifier(cv.data.haarcascades + "haarcascade_frontalface_alt2.xml")

image = cv.imread('people.jpg')
faces = face_detector.detectMultiScale(image, scaleFactor=1.05, minNeighbors=1, 
                                       minSize=(100, 100), maxSize=(500, 500))
for x, y, width, height in faces:
    cv.rectangle(image, (x, y), (x+width, y+height), (0, 0, 255), 2, cv.LINE_8, 0)
cv.imshow("faces", image)
cv.imwrite('face.jpg', image)
cv.waitKey(0)
cv.destroyAllWindows()
```
![image_1dgu29i911gor1bierphn8118bi1j.png-174.6kB][3]
äººè„¸æ£€æµ‹

### 2.çœ¼ç›æ£€æµ‹
```python
eye_detector = cv.CascadeClassifier(cv.data.haarcascades + "haarcascade_eye.xml")

# åŸºäºå‰é¢çš„äººè„¸æ£€æµ‹
for x, y, width, height in faces:
    cv.rectangle(image, (x, y), (x+width, y+height), (0, 0, 255), 2, cv.LINE_8, 0)

    # æå–äººè„¸
    roi = image[y:y+height,x:x+width]
    # æ£€æµ‹äººçœ¼
    eyes = eye_detector.detectMultiScale(roi, scaleFactor=1.1, minNeighbors=5,
                                         minSize=(20, 20), maxSize=(30,30))
    # ç»˜åˆ¶äººçœ¼                                  
    for ex, ey, ew, eh in eyes:
        cv.rectangle(roi, (ex, ey), (ex + ew, ey + eh), (255, 0, 0), 2)
```
![image_1dgu2akmk1n5q4lv116b1n6f1pf720.png-178.4kB][4]
çœ¼ç›æ£€æµ‹

### 3.å¾®ç¬‘æ£€æµ‹
```python
smile_detector = cv.CascadeClassifier(cv.data.haarcascades + "haarcascade_smile.xml")

# åŸºäºå‰é¢çš„äººè„¸æ£€æµ‹
for x, y, width, height in faces:
    cv.rectangle(image, (x, y), (x+width, y+height), (0, 0, 255), 2, cv.LINE_8, 0)

    # æå–äººè„¸
    roi = image[y:y+height,x:x+width]
    # æ£€æµ‹å¾®ç¬‘
    smiles = smile_detector.detectMultiScale(roi, scaleFactor=1.05, minNeighbors=2,
                                             minSize=(20, 20))
    # ç»˜åˆ¶å¾®ç¬‘æ¡†                                
    for sx, sy, sw, sh in smiles:
        cv.rectangle(roi, (sx, sy), (sx + sw, sy + sh), (0, 255, 0), 2)
        cv.putText(image, 'Smile', (x+10, y-7), cv.FONT_HERSHEY_SIMPLEX, 0.8, (0, 255, 0), 2)
```
![image_1dgu2bilt19du11pv1iopfvj92a2d.png-184.5kB][5]
å¾®ç¬‘æ£€æµ‹

###  4.äººè„¸æ£€æµ‹-LBP

**æ¦‚è¿°**

LBPå±€éƒ¨äºŒå€¼æ¨¡å¼(Local Binary Pattern)ä¸»è¦ç”¨æ¥å®ç°2Då›¾åƒçº¹ç†åˆ†æã€‚

åŸºæœ¬æ€æƒ³ï¼š
ç”¨æ¯ä¸ªåƒç´ è·Ÿå®ƒå‘¨å›´çš„åƒç´ ç›¸æ¯”è¾ƒå¾—åˆ°å±€éƒ¨å›¾åƒç»“æ„ï¼Œå‡è®¾ä¸­å¿ƒåƒç´ å€¼å¤§äºç›¸é‚»åƒç´ å€¼åˆ™åˆ™ç›¸é‚»åƒç´ ç‚¹èµ‹å€¼ä¸º1ï¼Œå¦åˆ™èµ‹å€¼ä¸º0ï¼Œæœ€ç»ˆå¯¹æ¯ä¸ªåƒç´ ç‚¹éƒ½ä¼šå¾—åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶å…«ä½çš„è¡¨ç¤ºï¼Œæ¯”å¦‚11100111ã€‚å‡è®¾3x3çš„çª—å£å¤§å°ï¼Œè¿™æ ·å¯¹æ¯ä¸ªåƒç´ ç‚¹æ¥è¯´ç»„åˆå¾—åˆ°çš„åƒç´ å€¼çš„ç©ºé—´ä¸º[0~2^8]ã€‚
![image_1dgu2crjka5eic7139i1ch412ig2q.png-92.4kB][6]
LBPå±€éƒ¨äºŒå€¼

**LBPç®—å­ï¼š**

OpenCVå†…ä½¿ç”¨çš„åœ†å½¢LBPç®—å­ï¼Œç”±äºä½¿ç”¨åœ†å½¢æ¥ä½œä¸ºçª—å£ï¼Œä¸èƒ½ä¿è¯æ‰€æœ‰åƒç´ ç‚¹éƒ½è½åœ¨åœ†å†…ï¼Œå› æ­¤éœ€è¦ä½¿ç”¨æ’å€¼ç®—æ³•å¯¹æ²¡æœ‰å®Œå…¨è½åœ¨åƒç´ ä½ç½®ç‚¹çš„ç‚¹è¿›è¡Œè®¡ç®—ç°åº¦å€¼ï¼Œopencvä½¿ç”¨çš„å°±æ˜¯åŒçº¿æ€§æ’å€¼ç®—æ³•ã€‚

LBPæ¨¡å¼ï¼š

![image_1dgu2dpvdg2v1fipu30t0bhi637.png-62.1kB][7]
LBPæ¨¡å¼

**ä¼˜åŠ¿ï¼š**

OpenCVä¸­ä½¿ç”¨LBPç‰¹å¾æ•°æ®æ£€æµ‹äººè„¸æ¯”ä½¿ç”¨Haarisæ•°æ®è¦å¿«ï¼ŒåŸå› åœ¨äºLBPç‰¹å¾ä¸ä¼šäº§ç”Ÿå°æ•°æ•°æ®ï¼Œé¿å…äº†æµ®ç‚¹æ•°è®¡ç®—å¼€é”€ã€‚

**å‡½æ•°å’Œç¤ºä¾‹**

LBPçš„å‡½æ•°è°ƒç”¨å’ŒHAARçº§è”ä¸€æ ·ï¼Œåªæ˜¯åŠ è½½çš„xmlä¸åŒã€‚ pythonä»£ç ï¼š

```python
# åŠ è½½LBPç®—æ³•
detector = cv.CascadeClassifier("lbpcascade_frontalface_improved.xml")
image = cv.imread('people.jpg')
# æ£€æµ‹äººè„¸
faces = detector.detectMultiScale(image, scaleFactor=1.05, minNeighbors=1,
                                  minSize=(30, 30), maxSize=(200, 200))
# ç»˜åˆ¶çŸ©å½¢æ¡†                            
for x, y, width, height in faces:
    cv.rectangle(image, (x, y), (x+width, y+height), (0, 0, 255), 2, cv.LINE_8, 0)
```
![image_1dgu2eu411arc1dde6irpolllj3k.png-171.5kB][8]
LBPäººè„¸æ£€æµ‹

https://github.com/JimmyHHua/opencv_tutorials.github.com

**å‚è€ƒ**

ğŸ‘ğŸ‘ğŸ‘- OpenCV Tutorial å®˜ç½‘

ğŸ‘ğŸ‘ğŸ‘- cv2çº§è”åˆ†ç±»å™¨CascadeClassifier

ğŸ‘ğŸ‘ğŸ‘- åŸºäºHaarç‰¹å¾çš„Adaboostçº§è”äººè„¸æ£€æµ‹åˆ†ç±»å™¨

ğŸ‘ğŸ‘ğŸ‘-è¯¦è§£LBPç‰¹å¾ä¸åº”ç”¨(äººè„¸è¯†åˆ«)


  [1]: http://static.zybuluo.com/harrytsz/3e5nawfcw2l86yc1oa1901o6/image_1dgu20f2oj22jkm8ut1r4krv3p.png
  [2]: http://static.zybuluo.com/harrytsz/fpb7qc9zry79tgt6c35zt202/image_1dgu24onh1ftab741llifq31euq16.png
  [3]: http://static.zybuluo.com/harrytsz/nx1qgwi6njdkduffpqo7uzsr/image_1dgu29i911gor1bierphn8118bi1j.png
  [4]: http://static.zybuluo.com/harrytsz/jvibtw5ra7qsy3vjfceooknx/image_1dgu2akmk1n5q4lv116b1n6f1pf720.png
  [5]: http://static.zybuluo.com/harrytsz/i83m25o9qqzc1xyontj7i86h/image_1dgu2bilt19du11pv1iopfvj92a2d.png
  [6]: http://static.zybuluo.com/harrytsz/smn2mmdn7dq6z39lvhc5s5wg/image_1dgu2crjka5eic7139i1ch412ig2q.png
  [7]: http://static.zybuluo.com/harrytsz/v1dnx769d678bm9xvsj4fs32/image_1dgu2dpvdg2v1fipu30t0bhi637.png
  [8]: http://static.zybuluo.com/harrytsz/ggcwh1tdsbdpx4a8w98w444k/image_1dgu2eu411arc1dde6irpolllj3k.png

